{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/*\nCopyright 2017 Resin.io\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/* tslint:disable: max-classes-per-file */\n\nimport * as Promise from 'bluebird';\nimport * as bodyParser from 'body-parser';\nimport * as crypto from 'crypto';\nimport * as express from 'express';\nimport { Server } from 'http';\nimport * as _ from 'lodash';\nimport * as querystring from 'querystring';\nimport * as request from 'request-promise';\nimport TypedError = require('typed-error');\n\nconst URL = 'https://api2.frontapp.com';\n\ninterface EventPreview {\n\t_links: Links;\n\tid: string;\n\ttype: string;\n\temitted_at: number;\n}\n\ninterface Request {\n\tmethod: string;\n\tpath: string;\n}\n\ntype InternalCallback = (err: Error | null, response: any | null) => void;\n\nexport class Front {\n\t// Setup resource paths for catagories.\n\t// Endpoint paths can require tags passed as parameters, as both mandatory and\n\t// optional tags.\n\t// <tag> is a mandatory tag and updates the path dynamically\n\t// [tag[:tag]] is an optional tag that is used to build query string at the end of the path\n\tpublic comment = {\n\t\tcreate: (params: CommentRequest.Create, callback?: Callback<Comment>): Promise<Comment> =>\n\t\t\tthis.httpCall({ method: 'POST', path: 'conversations/<conversation_id>/comments'}, params, callback),\n\t\tget: (params: CommentRequest.Get, callback?: Callback<Comment>): Promise<Comment> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'comments/<comment_id>'}, params, callback),\n\t\tlistMentions: (params: CommentRequest.ListMentions, callback?: Callback<CommentMentions>):\n\t\t\tPromise<CommentMentions> => this.httpCall({method: 'GET', path: 'comments/<comment_id>/mentions'},\n\t\t\tparams, callback),\n\t};\n\n\tpublic conversation = {\n\t\tget: (params: ConversationRequest.Get, callback?: Callback<Conversation>): Promise<Conversation> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'conversations/<conversation_id>'}, params, callback),\n\t\tlist: (params?: ConversationRequest.List, callback?: Callback<Conversations>): Promise<Conversations> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'conversations[q:page:limit]' }, params, callback),\n\t\tlistComments: (params: ConversationRequest.ListComments, callback?: Callback<ConversationComments>):\n\t\t\tPromise<ConversationComments> => this.httpCall({ method: 'GET',\n\t\t\tpath: 'conversations/<conversation_id>/comments' }, params, callback),\n\t\tlistFollowers: (params: ConversationRequest.ListFollowers,\n\t\t\tcallback?: Callback<ConversationFollowers>): Promise<ConversationFollowers> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'conversations/<conversation_id>/followers' }, params, callback),\n\t\tlistInboxes: (params: ConversationRequest.ListInboxes,\n\t\t\tcallback?: Callback<ConversationInboxes>): Promise<ConversationInboxes> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'conversations/<conversation_id>/inboxes' }, params, callback),\n\t\tlistMessages: (params: ConversationRequest.ListMessages,\n\t\t\tcallback?: Callback<ConversationMessages>): Promise<ConversationMessages> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'conversations/<conversation_id>/messages[page:limit]' },\n\t\t\tparams, callback),\n\t\tupdate: (params: ConversationRequest.Update, callback?: Callback<void>): Promise<void> =>\n\t\t\tthis.httpCall({ method: 'PATCH', path: 'conversations/<conversation_id>' }, params, callback),\n\t};\n\n\tpublic inbox = {\n\t\tcreate: (params: InboxRequest.Create, callback?: Callback<InboxCreation>): Promise<InboxCreation> =>\n\t\t\tthis.httpCall({ method: 'POST', path: 'inboxes' }, params, callback),\n\t\tget: (params: InboxRequest.Get, callback?: Callback<Inbox>): Promise<Inbox> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'inboxes/<inbox_id>' }, params, callback),\n\t\tlist: (callback?: Callback<Inboxes>): Promise<Inboxes> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'inboxes' }, null, callback),\n\t\tlistChannels: (params: InboxRequest.ListChannels, callback?: Callback<InboxChannels>):\n\t\t\tPromise<InboxChannels> => this.httpCall({ method: 'GET', path: 'inboxes/<inbox_id>/channels' },\n\t\t\tparams, callback),\n\t\tlistConversations: (params: InboxRequest.ListConversations, callback?: Callback<InboxConversations>):\n\t\t\tPromise<InboxConversations> => this.httpCall({ method: 'GET',\n\t\t\tpath: 'inboxes/<inbox_id>/conversations[q:page:limit]' }, params, callback),\n\t\tlistTeammates: (params: InboxRequest.ListTeammates, callback?: Callback<InboxTeammates>):\n\t\t\tPromise<InboxTeammates> => this.httpCall({ method: 'GET', path: 'inboxes/<inbox_id>/teammates' },\n\t\t\tparams, callback),\n\t};\n\n\tpublic message = {\n\t\tget: (params: MessageRequest.Get, callback?: Callback<Message>): Promise<Message> =>\n\t\t\tthis.httpCall({ method: 'GET', path: 'messages/<message_id>' }, params, callback),\n\t\treceiveCustom: (params: MessageRequest.ReceiveCustom,\n\t\t\tcallback?: Callback<ConversationReference>): Promise<ConversationReference> =>\n\t\t\tthis.httpCall({ method: 'POST', path: 'channels/<channel_id>/incoming_messages' }, params, callback),\n\t\treply: (params: MessageRequest.Reply, callback?: Callback<Status>): Promise<Status> =>\n\t\t\tthis.httpCall({ method: 'POST', path: 'conversations/<conversation_id>/messages' }, params, callback),\n\t\tsend: (params: MessageRequest.Send, callback?: Callback<ConversationReference>):\n\t\t\tPromise<ConversationReference> => this.httpCall({ method: 'POST',\n\t\t\tpath: 'channels/<channel_id>/messages' }, params, callback),\n\t};\n\n\tpublic topic = {\n\t\tlistConversations: (params: TopicRequest.ListConversations, callback?: Callback<TopicConversations>):\n\t\tPromise<TopicConversations> => this.httpCall({ method: 'GET',\n\t\t\tpath: 'topics/<topic_id>/conversations[q:page:limit]' }, params, callback),\n\t};\n\n\t// Keys for Front access and event verification.\n\tprivate apiKey: string;\n\tprivate apiSecret: string;\n\n\tconstructor(apiKey: string, apiSecret?: string) {\n\t\t// Key.\n\t\tthis.apiKey = apiKey;\n\t\t// Event signature secret.\n\t\tif (apiSecret) {\n\t\t\tthis.apiSecret = apiSecret;\n\t\t}\n\t}\n\n\tpublic registerEvents(opts: EventHookOptions, callback: EventCallback): Server | void {\n\t\tlet httpServer: Server | void;\n\t\tlet listener: express.Application;\n\t\tconst eventQueue: string[] = [];\n\t\tconst requestEvent = () => {\n\t\t\t// Get next event in the queue.\n\t\t\tconst eventId = eventQueue[0];\n\t\t\tthis.httpCall({ path: 'events/<event_id>', method: 'GET' }, {\n\t\t\t\tevent_id: eventId\n\t\t\t}).asCallback(callback)\n\t\t\t.finally(() => {\n\t\t\t\t// Get another event if there is one, else finish.\n\t\t\t\teventQueue.shift();\n\t\t\t\tif (eventQueue.length > 0) {\n\t\t\t\t\trequestEvent();\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t\tconst addToEventQueue = (id: string): void => {\n\t\t\t// Push the event onto the queue. If there's nothing already\n\t\t\t// on it, retrieve now, else just return.\n\t\t\teventQueue.push(id);\n\t\t\tif (eventQueue.length === 1) {\n\t\t\t\trequestEvent();\n\t\t\t}\n\t\t};\n\n\t\t// Ensure we have relevant details to hook into events.\n\t\tif (!this.apiSecret) {\n\t\t\tthrow new Error('No secret key registered');\n\t\t}\n\t\tif (!opts || (opts.server && opts.port) || (!opts.server && !opts.port)) {\n\t\t\tthrow new Error('Pass either an Express instance or a port to listen on');\n\t\t}\n\t\tif (opts.port && typeof opts.port !== 'number') {\n\t\t\tthrow new Error('`port` must be a number');\n\t\t}\n\t\tconst hookPath = opts.hookPath || '/fronthook';\n\n\t\t// If we weren't passed an express instance, we create one.\n\t\tif (opts.server) {\n\t\t\tlistener = opts.server;\n\t\t} else {\n\t\t\tlistener = express();\n\n\t\t\t// Use body parser.\n\t\t\tlistener.use(bodyParser.urlencoded({ extended: true }));\n\t\t\tlistener.use(bodyParser.json());\n\n\t\t\thttpServer = listener.listen(opts.port);\n\t\t}\n\n\t\t// Listen for Webhooks on the path specified by the client.\n\t\tlistener.post(hookPath, (req: express.Request, res: express.Response) => {\n\t\t\tconst eventPreview: EventPreview = req.body;\n\n\t\t\t// Ensure that the sender is authorised and uses our secret.\n\t\t\tconst XFrontSignature = req.get('X-Front-Signature');\n\t\t\tif (!XFrontSignature || !this.validateEventSignature(eventPreview, XFrontSignature)) {\n\t\t\t\tres.sendStatus(401);\n\t\t\t\tthrow new Error('Event Signature does not match registered secret');\n\t\t\t}\n\n\t\t\t// Let the hook get on with it.\n\t\t\tres.sendStatus(200);\n\n\t\t\t// Queue up retrieval of the actual event. We need to queue these because\n\t\t\t// we might otherwise receive them out of order.\n\t\t\taddToEventQueue(eventPreview.id);\n\t\t});\n\n\t\treturn httpServer;\n\t}\n\n\tprivate httpCall(details: Request, params: any, callback?: InternalCallback): Promise<any | void>  {\n\t\tconst requestOpts = {\n\t\t\tbody: params || {},\n\t\t\theaders: {\n\t\t\t\tAuthorization: `Bearer ${this.apiKey}`\n\t\t\t},\n\t\t\tjson: true,\n\t\t\tmethod: details.method,\n\t\t\turl: `${URL}/${this.formatPath(details.path, params)}`\n\t\t};\n\n\t\t// Make the request.\n\t\treturn request(requestOpts).promise().catch((error: any) => {\n\t\t\t// Format this into something useful, if we can.\n\t\t\tthrow new FrontError(error);\n\t\t}).asCallback(callback);\n\t}\n\n\tprivate formatPath(path: string, data: RequestData = {}): string {\n\t\tlet newPath = path;\n\t\tconst reSearch = (re: RegExp, operation: (matches: RegExpMatchArray) => void) => {\n\t\t\tlet matches = path.match(re);\n\t\t\tif (matches) {\n\t\t\t\toperation(matches);\n\t\t\t}\n\t\t};\n\n\t\t// Find the mandatories. If we don't get them, then we error.\n\t\treSearch(/<(.*?)>/g, (mandatoryTags: RegExpMatchArray) => {\n\t\t\t_.map(mandatoryTags, (tag) => {\n\t\t\t\tconst tagName = tag.substring(1, tag.length -1);\n\t\t\t\tif (!data[tagName]) {\n\t\t\t\t\tthrow new Error(`Tag ${tag} not found in parameter data`);\n\t\t\t\t}\n\t\t\t\tnewPath = newPath.replace(tag, data[tagName]);\n\t\t\t});\n\t\t});\n\n\t\t// Look for optionals. There should be a max of one as they extend a query\n\t\t// string.\n\t\treSearch(/\\[(.*?)\\]/g, (optionalTags: RegExpMatchArray) => {\n\t\t\tif (optionalTags.length > 1) {\n\t\t\t\tthrow new Error(`Front endpoint ${path} is incorrectly defined`);\n\t\t\t}\n\n\t\t\t// Add each of these tags to an array used for the query string.\n\t\t\tconst trimmedTags = optionalTags[0];\n\t\t\tconst tags = trimmedTags.substring(1, trimmedTags.length - 1).split(':');\n\t\t\tconst queryTags: { [key: string]: string } = {};\n\n\t\t\t// Ensure we remove the optional signature.\n\t\t\t// QueryString any tags that aren't the search string.\n\t\t\tnewPath = newPath.replace(trimmedTags, '');\n\t\t\t_.each(tags, (tag) => {\n\t\t\t\tif ((tag !== 'q') && data[tag]) {\n\t\t\t\t\tqueryTags[tag] = data[tag];\n\t\t\t\t}\n\t\t\t});\n\t\t\tnewPath = `${newPath}?${querystring.stringify(queryTags)}`;\n\n\t\t\t// If we have a search string, append fully qualified string here.\n\t\t\tif (_.includes(tags, 'q')) {\n\t\t\t\tnewPath += `&${data.q}`;\n\t\t\t}\n\t\t});\n\n\t\treturn newPath;\n\t}\n\n\tprivate validateEventSignature(data: any, signature: string): boolean {\n\t\tlet hash = '';\n\t\ttry {\n\t\t\thash = crypto.createHmac('sha1', this.apiSecret)\n\t\t\t\t.update(JSON.stringify(data))\n\t\t\t\t.digest('base64');\n\t\t} catch (err) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn hash === signature;\n\t}\n}\n\nexport type Callback<T> = (err: Error | null, response: T | null) => void;\n\nexport interface Attachment {\n\tfilename: string;\n\turl: string;\n\tcontentType: string;\n\tsize: number;\n\tmetadata: any;\n}\n\nexport interface Author {\n\t_links: Links;\n\tid: string;\n\temail: string;\n\tusername: string;\n\tfirst_name: string;\n\tlast_name: string;\n\tis_admin: boolean;\n\tis_available: boolean;\n}\n\nexport interface ConversationReference {\n\tconversation_reference: string;\n\tstatus?: string;\n}\n\nexport class FrontError extends TypedError {\n\tpublic name: string;\n\tpublic status: number;\n\tpublic title: string;\n\tpublic message: string;\n\tpublic details?: string[];\n\t[key: string]: number | string | string[] | void;\n\n\tconstructor(error: any) {\n\t\tsuper(error);\n\n\t\tconst frontError = error.error._error;\n\t\tif (frontError) {\n\t\t\t_.each([ 'status', 'title', 'message', 'details' ], (key) => {\n\t\t\t\tif (frontError[key]) {\n\t\t\t\t\tthis[key] = frontError[key];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n\nexport interface Event {\n\t_links: Links;\n\tid: string;\n\ttype: string;\n\temitted_at: number;\n\tsource: {\n\t\t_meta: {\n\t\t\ttype: any;\n\t\t};\n\t\tdata?: any;\n\t};\n\ttarget?: {\n\t\t_meta: {\n\t\t\ttype: any;\n\t\t};\n\t\tdata?: any;\n\t};\n\tconversation: Conversation;\n}\n\nexport interface Links {\n\tself: string;\n\trelated: {\n\t\tchannels?: string;\n\t\tcomments?: string;\n\t\tconversation?: string;\n\t\tconversations?: string;\n\t\tcontact?: string;\n\t\tevents?: string;\n\t\tfollowers?: string;\n\t\tinboxes?: string;\n\t\tmessages?: string;\n\t\tmessage_replied_to?: string;\n\t\tmentions?: string;\n\t\tteammates?: string;\n\t};\n}\n\nexport interface Pagination {\n\tlimit: number;\n\tnext?: string;\n\tprev?: string;\n}\n\nexport interface Recipient {\n\t_links: Links;\n\thandle: string;\n\trole: string;\n}\n\nexport interface Sender {\n\tcontact_id?: string;\n\tname?: string;\n\thandle: string;\n}\n\nexport interface Status {\n\tstatus: string;\n}\n\nexport interface Tag {\n\t_links: Links;\n\tid: string;\n\tname: string;\n}\n\n// Channels ///////////////////////////////////////////////////////////////////\nexport interface Channel {\n\t_links: Links;\n\taddress: string;\n\tid: string;\n\tsend_as: string;\n\tsettings?: ChannelSettings;\n\ttype: string;\n}\n\nexport interface ChannelSettings {\n\twebhook_url: string;\n}\n\n// Comments ///////////////////////////////////////////////////////////////////\nexport interface Comment {\n\t_links: Links;\n\tauthor: Author;\n\tbody: string;\n\tid: string;\n\tposted_at: string;\n}\n\nexport interface CommentMentions {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Author[];\n}\n\n// Used for making requests\nexport namespace CommentRequest {\n\t// Request structures /////////////////////////////////////////////////////\n\texport interface Create {\n\t\tconversation_id: string;\n\t\tauthor_id: string;\n\t\tbody: string;\n\t\t[key: string]: string;\n\t}\n\n\texport interface Get {\n\t\tcomment_id: string;\n\t\t[key: string]: string;\n\t}\n\n\texport interface ListMentions {\n\t\tcomment_id: string;\n\t\t[key: string]: string;\n\t}\n}\n\n// Conversations //////////////////////////////////////////////////////////////\nexport interface Conversation {\n\t_links: Links;\n\tid: string;\n\tsubject: string;\n\tstatus: string;\n\tassignee: Author;\n\trecipient: Recipient;\n\ttags: Tag[] | void;\n\tlast_message: Message;\n\tcreated_at: number;\n}\n\nexport interface Conversations {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Conversation[];\n}\n\nexport interface ConversationComments {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Comment[];\n}\n\nexport interface ConversationInboxes {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Inbox[];\n}\n\nexport interface ConversationFollowers {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Author[];\n}\n\nexport interface ConversationMessages {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Message[];\n}\n\nexport namespace ConversationRequest {\n\t// Request structures /////////////////////////////////////////////////////\n\texport interface List {\n\t\tq?: string;\n\t\tpage?: number;\n\t\tlimit?: number;\n\t\t[key: string]: string | number | void;\n\t}\n\n\texport interface Get {\n\t\tconversation_id: string;\n\t\t[key: string]: string;\n\t}\n\n\texport interface Update {\n\t\tconversation_id: string;\n\t\tassignee_id?: string;\n\t\tinbox_id?: string;\n\t\tstatus?: string;\n\t\ttags?: string[];\n\t\t[key: string]: string | string[] | void;\n\t}\n\n\texport interface ListComments {\n\t\tconversation_id: string;\n\t\t[key: string]: string;\n\t}\n\n\texport interface ListInboxes {\n\t\tconversation_id: string;\n\t\t[key: string]: string;\n\t}\n\n\texport interface ListFollowers {\n\t\tconversation_id: string;\n\t\t[key: string]: string;\n\t}\n\n\texport interface ListMessages {\n\t\tconversation_id: string;\n\t\tpage?: number;\n\t\tlimit?: number;\n\t\t[key: string]: string | number | void;\n\t}\n}\n\n// Inboxes ////////////////////////////////////////////////////////////////////\nexport interface Inbox {\n\t_links: Links;\n\taddress: string;\n\tid: string;\n\tname: string;\n\tsend_as: string;\n\ttype: string;\n}\n\nexport interface Inboxes {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Inbox[];\n}\n\nexport interface InboxCreation {\n\tid: string;\n\tname: string;\n}\n\nexport interface InboxChannels {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Channel[];\n}\n\nexport interface InboxConversations {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Conversation[];\n}\n\nexport interface InboxTeammates {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Author[];\n}\n\nexport namespace InboxRequest {\n\t// Request structures /////////////////////////////////////////////////////\n\texport interface Create {\n\t\tname: string;\n\t\tteammate_ids?: string[];\n\t\t[key: string]: string | string[] | void;\n\t}\n\n\texport interface Get {\n\t\tinbox_id: string;\n\t\t[key: string]: string;\n\t}\n\n\texport interface ListChannels {\n\t\tinbox_id: string;\n\t\t[key: string]: string;\n\t}\n\n\texport interface ListConversations {\n\t\tinbox_id: string;\n\t\tq?: string;\n\t\tpage?: number;\n\t\tlimit?: number;\n\t\t[key: string]: string | number | void;\n\t}\n\n\texport interface ListTeammates {\n\t\tinbox_id: string;\n\t\t[key: string]: string;\n\t}\n}\n\n// Messages ///////////////////////////////////////////////////////////////////\nexport interface Message {\n\t_links: Links;\n\tid: string;\n\ttype: string;\n\tis_inbound: boolean;\n\tcreated_at: number;\n\tblurb: string;\n\tauthor: Author;\n\trecipients: Recipient[];\n\tbody: string;\n\ttext: string;\n\tattachments: Attachment[];\n\tmetadata: any;\n}\n\nexport namespace MessageRequest {\n\t// Request structures /////////////////////////////////////////////////////\n\texport interface MessageOptions {\n\t\ttags?: string[];\n\t\tarchive?: boolean;\n\t\t[key: string]: string[] | boolean | void;\n\t}\n\n\texport interface Get {\n\t\tmessage_id: string;\n\t\t[key: string]: string;\n\t}\n\n\t// Base object for message sending.\n\texport interface SendBase {\n\t\tauthor_id?: string;\n\t\tsubject?: string;\n\t\tbody: string;\n\t\ttext?: string;\n\t\toptions?: MessageOptions;\n\t\tcc?: string[];\n\t\tbcc?: string[];\n\t\t[key: string]: string | string[] | MessageOptions | void;\n\t}\n\n\t// Send a MessageRequest.\n\texport interface Send extends SendBase {\n\t\tchannel_id: string;\n\t\tto: string[];\n\t\t[key: string]: string | string[] | MessageOptions | void;\n\t}\n\n\t// Send a reply to a ConversationRequest.\n\texport interface Reply extends SendBase {\n\t\tconversation_id: string;\n\t\tto?: string[];\n\t\tchannel_id?: string;\n\t\t[key: string]: string | string[] | MessageOptions | void;\n\t}\n\n\texport interface ReceiveCustom {\n\t\tchannel_id: string;\n\t\tsender: Sender;\n\t\tsubject?: string;\n\t\tbody: string;\n\t\tbody_format?: string;\n\t\tmetadata?: any;\n\t\t[key: string]: string | any | void;\n\t}\n}\n\n// Topics /////////////////////////////////////////////////////////////////////\nexport interface TopicConversations {\n\t_pagination: Pagination;\n\t_links: Links;\n\t_results: Conversation[];\n}\n\nexport namespace TopicRequest {\n\texport interface ListConversations {\n\t\ttopic_id: string;\n\t\tq?: string;\n\t\tpage?: number;\n\t\tlimit?: number;\n\t\t[key: string]: string | number | void;\n\t}\n}\n\n// Export Types ///////////////////////////////////////////////////////////////\nexport type EventCallback = (error: Error | null, event?: Event) => void;\n\nexport interface EventHookOptions {\n\tserver?: express.Application;\n\tport?: number;\n\thookPath?: string;\n}\n\nexport type RequestData =\n\tCommentRequest.Create | CommentRequest.Get | CommentRequest.ListMentions |\n\tConversationRequest.List | ConversationRequest.Get | ConversationRequest.Update |\n\t\tConversationRequest.ListComments | ConversationRequest.ListFollowers |\n\t\tConversationRequest.ListInboxes | ConversationRequest.ListMessages |\n\tInboxRequest.Create | InboxRequest.Get | InboxRequest.ListChannels |\n\t\tInboxRequest.ListConversations | InboxRequest.ListTeammates |\n\tMessageRequest.Get | MessageRequest.Send | MessageRequest.Reply |\n\t\tMessageRequest.ReceiveCustom |\n\tTopicRequest.ListConversations;\n\nexport type ResponseData =\n\tAttachment | Author | Links | Recipient | Sender | Tag | ConversationReference |\n\tComment | CommentMentions |\n\tConversation | Conversations | ConversationComments | ConversationInboxes | ConversationFollowers |\n\t\tConversationMessages |\n\tInbox | Inboxes | InboxCreation | InboxChannels | InboxConversations |\n\t\tInboxTeammates |\n\tMessage |\n\tTopicConversations;\n"],"sourceRoot":"../lib"}